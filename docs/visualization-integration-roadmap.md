# Trust Debt Visualization Integration Roadmap

## Current State (Regression Analysis)

### What We Have
1. **trust-debt-report.html** (48K) - Matrix visualization with double-walled boundaries ‚úÖ
   - 25√ó25 asymmetric matrix with ShortLex ordering
   - Stats grid showing grade, scores, orthogonality
   - Double-walled boundaries between category groups
   - Pipeline execution status
   - **Missing**: Line charts for historical trends

2. **trust-debt-reality-intent-matrix.js** (Enhanced) - Delta calculation engine ‚úÖ
   - Commit caching (1-hour TTL)
   - Validation methods (diagonal coherence, zero detection, asymmetry)
   - CLI configuration (--since, --diagnostics, --no-cache)
   - Generates `trust-debt-reality-intent-matrix.html` (113K, simpler visualization)

3. **trust-debt-reality-intent-matrix.html** (113K) - **Wrong file** ‚ùå
   - Basic matrix without line charts
   - Less comprehensive than trust-debt-report.html
   - Not integrated with Agent 5 timeline data

### What We Lost
- **Historical trend line charts** showing Trust Debt evolution over time
- Integration between Agent 5 (Timeline Analyzer) and HTML visualization
- Chart.js is loaded but not used

---

## Integration Gaps

### Gap 1: Agent 5 Timeline Data Not Visualized
**Problem**: Agent 5 (`5-timeline-history.json`) produces historical analysis but it's not displayed

**File**: `agent5-timeline-analyzer.js`
**Expected Output**:
```json
{
  "timeline": [
    {"date": "2025-01-01", "trustDebt": 8130, "grade": "B"},
    {"date": "2025-01-15", "trustDebt": 7850, "grade": "B+"},
    {"date": "2025-02-01", "trustDebt": 7200, "grade": "A-"}
  ],
  "trends": {
    "improving": ["AüöÄ CoreEngine", "Cüí® Visualization"],
    "degrading": ["Eüé® BusinessLayer"]
  }
}
```

**Missing**:
- Line charts showing Trust Debt over time
- Category-specific trend lines
- Validation score trends (diagonal coherence, asymmetry ratio)

### Gap 2: Delta Validation Results Not Visualized
**Problem**: `trust-debt-reality-intent-matrix.js` now produces validation data but it's not shown in trust-debt-report.html

**Available Data** (from enhanced delta script):
```json
{
  "validations": {
    "diagonal": {"passed": false, "avgScore": 0.184, "threshold": 0.7},
    "zeros": {"passed": true, "zeroCount": 17, "totalCells": 289},
    "asymmetry": {"passed": false, "ratio": 0.41, "interpretation": "Over-documenting"}
  }
}
```

**Missing**:
- Visual indicators for validation pass/fail
- Charts showing validation trends over time
- Diagnostic output in HTML report

### Gap 3: Disconnected File Generation
**Problem**: Two separate HTML files with different purposes

- `trust-debt-report.html` - Manual/Agent 7 generated, comprehensive layout
- `trust-debt-reality-intent-matrix.html` - Auto-generated by delta script, simpler

**Ideal**: Single source of truth that combines:
- Comprehensive matrix visualization (from trust-debt-report.html)
- Real-time delta validation (from trust-debt-reality-intent-matrix.js)
- Historical trends (from Agent 5)

---

## What Needs to Be Done (Priority Order)

### Priority 1: Integrate Agent 5 Timeline Charts into trust-debt-report.html

**Location**: After the matrix section, before pipeline execution status

**Implementation**:
```html
<!-- Add after line 661 in trust-debt-report.html -->
<div class="charts-container" style="margin-top: 30px;">
    <h3 style="margin-bottom: 15px;">üìà Historical Trends</h3>

    <!-- Trust Debt Evolution -->
    <div style="background: rgba(255,255,255,0.02); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h4 style="color: #00ff88;">Trust Debt Over Time</h4>
        <canvas id="trustDebtChart" width="400" height="150"></canvas>
    </div>

    <!-- Category Breakdown -->
    <div style="background: rgba(255,255,255,0.02); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h4 style="color: #00aaff;">Category Health Trends</h4>
        <canvas id="categoryTrendsChart" width="400" height="150"></canvas>
    </div>

    <!-- Validation Metrics -->
    <div style="background: rgba(255,255,255,0.02); padding: 20px; border-radius: 8px;">
        <h4 style="color: #ffaa00;">Validation Scores</h4>
        <canvas id="validationChart" width="400" height="150"></canvas>
    </div>
</div>

<script>
// Load data from Agent 5 and validation results
fetch('5-timeline-history.json')
    .then(r => r.json())
    .then(data => {
        // Trust Debt trend line
        new Chart(document.getElementById('trustDebtChart'), {
            type: 'line',
            data: {
                labels: data.timeline.map(t => t.date),
                datasets: [{
                    label: 'Trust Debt',
                    data: data.timeline.map(t => t.trustDebt),
                    borderColor: '#00ff88',
                    tension: 0.4
                }]
            },
            options: {
                scales: {y: {beginAtZero: false}},
                plugins: {legend: {labels: {color: '#fff'}}}
            }
        });

        // Category trends
        new Chart(document.getElementById('categoryTrendsChart'), {
            type: 'line',
            data: {
                labels: data.timeline.map(t => t.date),
                datasets: [
                    {label: 'AüöÄ CoreEngine', data: data.categories.A, borderColor: '#00ff88'},
                    {label: 'Büîí Documentation', data: data.categories.B, borderColor: '#00aaff'},
                    {label: 'Cüí® Visualization', data: data.categories.C, borderColor: '#ffaa00'},
                    {label: 'Düß† Integration', data: data.categories.D, borderColor: '#ff00aa'},
                    {label: 'Eüé® BusinessLayer', data: data.categories.E, borderColor: '#ff0044'},
                    {label: 'F‚ö° Claude-Flow', data: data.categories.F, borderColor: '#3b82f6'}
                ]
            }
        });

        // Validation metrics
        new Chart(document.getElementById('validationChart'), {
            type: 'line',
            data: {
                labels: data.timeline.map(t => t.date),
                datasets: [
                    {label: 'Diagonal Coherence', data: data.validation.diagonal, borderColor: '#00ff88'},
                    {label: 'Zero Count %', data: data.validation.zeros, borderColor: '#ff8800'},
                    {label: 'Asymmetry Ratio', data: data.validation.asymmetry, borderColor: '#ff00aa'}
                ]
            }
        });
    });
</script>
```

**Dependencies**:
- Agent 5 must generate `5-timeline-history.json` with correct structure
- Chart.js already loaded ‚úÖ

**Files to Modify**:
- `trust-debt-report.html` (add charts section)
- `agent5-timeline-analyzer.js` (ensure JSON output format matches)

---

### Priority 2: Agent 5 Must Produce Correct Timeline Data

**Current State**: Agent 5 likely produces git history but not formatted for charts

**Required Output Format** (`5-timeline-history.json`):
```json
{
  "timeline": [
    {
      "date": "2025-01-01",
      "trustDebt": 8130,
      "grade": "B",
      "processHealth": 0.75,
      "orthogonality": 0.89
    }
  ],
  "categories": {
    "A": [118, 115, 112, 108],
    "B": [38, 40, 42, 45],
    "C": [52, 55, 58, 60],
    "D": [45, 48, 50, 53],
    "E": [41, 43, 45, 48],
    "F": [92, 88, 85, 82]
  },
  "validation": {
    "diagonal": [0.15, 0.18, 0.22, 0.28],
    "zeros": [19.4, 15.2, 12.1, 8.3],
    "asymmetry": [0.41, 0.55, 0.68, 0.85]
  }
}
```

**Implementation Strategy**:
1. Agent 5 reads git log with multiple time snapshots
2. For each snapshot (e.g., every 7 days), run Trust Debt calculation
3. Store results in timeline array
4. Track category-specific scores over time
5. Include validation metrics if available

**File**: `agent5-timeline-analyzer.js`
**Function to Add**:
```javascript
function generateTimelineSnapshots(days = 90, interval = 7) {
  const snapshots = [];
  const dates = [];

  // Generate date range
  for (let i = 0; i <= days; i += interval) {
    dates.push(new Date(Date.now() - i * 24 * 60 * 60 * 1000));
  }

  // For each date, calculate Trust Debt snapshot
  dates.forEach(date => {
    const commits = getCommitsSince(date);
    const matrix = calculateMatrixSnapshot(commits);
    const validation = validateMatrix(matrix);

    snapshots.push({
      date: date.toISOString().split('T')[0],
      trustDebt: calculateTotalDebt(matrix),
      grade: calculateGrade(matrix),
      categories: extractCategoryScores(matrix),
      validation: validation
    });
  });

  return snapshots;
}
```

---

### Priority 3: Connect Delta Validation to HTML Report

**Problem**: Enhanced validation from `trust-debt-reality-intent-matrix.js` isn't shown in main report

**Solution**: Add validation badges to trust-debt-report.html

**Location**: In stats grid (after line 266)

**Implementation**:
```html
<div class="stats">
    <!-- Existing stats... -->

    <!-- NEW: Validation indicators -->
    <div class="stat">
        <div class="stat-value" style="color: #ffaa00;">18.4%</div>
        <div class="stat-label">Diagonal Coherence</div>
        <div style="color: #ff8800; font-size: 0.8em;">‚ö† Below 70% threshold</div>
    </div>
    <div class="stat">
        <div class="stat-value" style="color: #00ff88;">‚úÖ</div>
        <div class="stat-label">Zero Detection</div>
        <div style="color: #00ff88; font-size: 0.8em;">5.9% (< 10%)</div>
    </div>
    <div class="stat">
        <div class="stat-value" style="color: #ff8800;">0.41</div>
        <div class="stat-label">Asymmetry Ratio</div>
        <div style="color: #ff8800; font-size: 0.8em;">‚ö† Over-documenting</div>
    </div>
</div>
```

**Data Source**:
- Read from `trust-debt-reality-intent-matrix.json` (validation field)
- OR: Pass validation results directly from Agent 7

---

### Priority 4: Unified Report Generation Script

**Problem**: Manual HTML editing vs automated generation

**Solution**: Create `agent7-report-assembler.js` that:
1. Reads all agent output JSON files (0-6)
2. Loads validation data from delta script
3. Generates complete trust-debt-report.html with:
   - Matrix (from Agent 3)
   - Stats (from Agent 4)
   - Timeline charts (from Agent 5)
   - Validation badges (from delta script)

**Implementation**:
```javascript
// agent7-report-assembler.js
function assembleReport() {
  const outcomes = JSON.parse(fs.readFileSync('0-outcome-requirements.json'));
  const keywords = JSON.parse(fs.readFileSync('1-indexed-keywords.json'));
  const categories = JSON.parse(fs.readFileSync('2-categories-balanced.json'));
  const matrix = JSON.parse(fs.readFileSync('3-presence-matrix.json'));
  const stats = JSON.parse(fs.readFileSync('4-grades-statistics.json'));
  const timeline = JSON.parse(fs.readFileSync('5-timeline-history.json'));
  const analysis = JSON.parse(fs.readFileSync('6-analysis-narratives.json'));

  // NEW: Load delta validation
  const deltaValidation = JSON.parse(fs.readFileSync('trust-debt-reality-intent-matrix.json')).validations;

  return generateHTML({
    matrix,
    stats,
    timeline,
    validation: deltaValidation,
    categories
  });
}
```

---

## Technical Debt Resolution Plan

### Phase 1: Quick Wins (1-2 hours)
1. ‚úÖ Add canvas elements to trust-debt-report.html
2. ‚úÖ Create sample `5-timeline-history.json` with mock data
3. ‚úÖ Implement Chart.js line charts with sample data
4. ‚úÖ Verify charts render correctly

### Phase 2: Agent Integration (3-4 hours)
1. ‚úÖ Enhance Agent 5 to produce timeline snapshots
2. ‚úÖ Connect Agent 5 output to chart data
3. ‚úÖ Add validation badges from delta script
4. ‚úÖ Test with real historical git data

### Phase 3: Automation (2-3 hours)
1. ‚úÖ Refactor Agent 7 to auto-generate complete HTML
2. ‚úÖ Remove manual HTML editing requirement
3. ‚úÖ Add `intentguard q` integration for full pipeline
4. ‚úÖ Ensure `open trust-debt-report.html` shows complete visualization

---

## Success Criteria

### Minimum Viable Visualization
- [ ] trust-debt-report.html shows 3 line charts
- [ ] Charts display last 90 days of Trust Debt history
- [ ] Validation badges show current health status
- [ ] `intentguard q` generates complete report automatically

### Full Production System
- [ ] Agent 5 generates timeline data from git history
- [ ] Charts update automatically with new commits
- [ ] Validation trends visible over time
- [ ] Single HTML file contains all visualizations
- [ ] No manual editing required
- [ ] PDF export includes charts

---

## File Mapping

| Agent | Input | Output | Visualization Target |
|-------|-------|--------|---------------------|
| 0 | HTML reports | 0-outcome-requirements.json | Stats grid |
| 1 | Codebase | 1-indexed-keywords.json | - |
| 2 | Keywords | 2-categories-balanced.json | Matrix headers |
| 3 | Categories | 3-presence-matrix.json | Matrix cells |
| 4 | Matrix | 4-grades-statistics.json | Stats grid |
| 5 | Git history | 5-timeline-history.json | **LINE CHARTS** |
| 6 | All above | 6-analysis-narratives.json | Analysis section |
| 7 | All above | trust-debt-report.html | **FINAL REPORT** |
| Delta | Git + Docs | validations.json | Validation badges |

---

## Next Steps

1. **Document review**: Confirm this roadmap aligns with expectations
2. **Quick prototype**: Add Chart.js implementation with mock data
3. **Agent 5 enhancement**: Generate proper timeline JSON
4. **Integration test**: Run `intentguard q` and verify complete output
5. **Production deploy**: Ensure all charts render in final report

## Questions to Resolve

1. How many days of history should timeline charts show? (30, 60, 90, 180?)
2. Should validation trends be overlaid or separate chart?
3. What interval for snapshots? (daily, weekly, bi-weekly?)
4. Should charts be interactive (hover tooltips, zoom)?
5. Export to PDF - do charts need special handling?
